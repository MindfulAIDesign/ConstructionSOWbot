<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construction SOW Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #343541;
            color: #ececf1;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: #202123;
            border-bottom: 1px solid #4d4d4f;
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .model-badge {
            background: #ff6b35;
            color: #fff;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .title {
            font-size: 0.95rem;
            color: #ececf1;
        }

        .new-chat-btn {
            background: transparent;
            border: 1px solid #565869;
            color: #ececf1;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .new-chat-btn:hover {
            background: #40414f;
        }

        /* Chat Messages */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 0;
        }

        .message-wrapper {
            padding: 1.5rem 1rem;
            border-bottom: 1px solid #4d4d4f;
        }

        .message-wrapper.user {
            background: #343541;
        }

        .message-wrapper.assistant {
            background: #444654;
        }

        .message {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            gap: 1.5rem;
        }

        .avatar {
            width: 30px;
            height: 30px;
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .avatar.user {
            background: #5436da;
        }

        .avatar.assistant {
            background: #ff6b35;
            color: #fff;
        }

        .message-content {
            flex: 1;
            line-height: 1.7;
            font-size: 0.95rem;
        }

        .message-content h4 {
            margin-bottom: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
        }

        .message-content p {
            margin-bottom: 0.75rem;
        }

        .message-content ul {
            margin: 0.75rem 0 0.75rem 1.5rem;
        }

        .message-content li {
            margin-bottom: 0.5rem;
        }

        .message-content strong {
            font-weight: 600;
        }

        /* Welcome Message */
        .welcome {
            text-align: center;
            padding: 4rem 2rem;
            max-width: 600px;
            margin: auto;
        }

        .welcome h2 {
            font-size: 1.75rem;
            margin-bottom: 1rem;
            color: #ececf1;
        }

        .welcome p {
            color: #c5c5d2;
            line-height: 1.6;
            margin-bottom: 2rem;
        }

        .example-prompts {
            display: grid;
            gap: 0.75rem;
            margin-top: 2rem;
        }

        .example-prompt {
            background: #40414f;
            border: 1px solid #565869;
            padding: 0.875rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            font-size: 0.875rem;
            color: #ececf1;
        }

        .example-prompt:hover {
            background: #4a4b5f;
        }

        /* Input Area */
        .input-area {
            padding: 1rem;
            background: #343541;
        }

        .input-container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .chat-input {
            width: 100%;
            background: #40414f;
            border: 1px solid #565869;
            border-radius: 8px;
            padding: 0.875rem 3rem 0.875rem 3rem;
            color: #ececf1;
            font-size: 0.95rem;
            resize: none;
            font-family: inherit;
            line-height: 1.5;
            min-height: 52px;
            max-height: 200px;
        }

        .chat-input:focus {
            outline: none;
            border-color: #ececf1;
        }

        .chat-input::placeholder {
            color: #8e8ea0;
        }

        .send-button {
            position: absolute;
            right: 0.5rem;
            bottom: 0.625rem;
            background: #19c37d;
            border: none;
            color: #000;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .send-button:hover {
            background: #1a9d66;
        }

        .send-button:disabled {
            background: #40414f;
            cursor: not-allowed;
        }

        .send-icon {
            font-size: 1rem;
        }

        /* Upload Button */
        .upload-btn {
            position: absolute;
            left: 0.5rem;
            bottom: 0.625rem;
            background: transparent;
            border: none;
            color: #8e8ea0;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 1.2rem;
        }

        .upload-btn:hover {
            background: #40414f;
            color: #ececf1;
        }

        /* Upload Modal */
        .upload-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .upload-modal.active {
            display: flex;
        }

        .upload-content {
            background: #343541;
            border: 1px solid #565869;
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .upload-content h3 {
            margin-bottom: 1rem;
            color: #ececf1;
        }

        .upload-area {
            border: 2px dashed #565869;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            margin: 1rem 0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .upload-area:hover {
            border-color: #8e8ea0;
            background: #40414f;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .upload-tips {
            background: #40414f;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            text-align: left;
        }

        .upload-tips h4 {
            color: #ff6b35;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }

        .upload-tips ul {
            margin-left: 1.2rem;
            font-size: 0.85rem;
            color: #c5c5d2;
        }

        .upload-tips li {
            margin-bottom: 0.4rem;
        }

        .upload-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        .modal-btn {
            padding: 0.625rem 1.25rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .modal-btn-primary {
            background: #19c37d;
            border: none;
            color: #000;
            font-weight: 600;
        }

        .modal-btn-primary:hover {
            background: #1a9d66;
        }

        .modal-btn-secondary {
            background: transparent;
            border: 1px solid #565869;
            color: #ececf1;
        }

        .modal-btn-secondary:hover {
            background: #40414f;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 0.3rem;
            padding: 0.5rem 0;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #ececf1;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.3;
            }
            30% {
                opacity: 1;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #343541;
        }

        ::-webkit-scrollbar-thumb {
            background: #565869;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #6e6e80;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .message {
                gap: 1rem;
            }

            .welcome {
                padding: 2rem 1rem;
            }

            .welcome h2 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="model-badge">SOW Generator</div>
                <div class="title">Construction AI Assistant</div>
            </div>
            <button class="new-chat-btn" onclick="clearChat()">New chat</button>
        </div>

        <!-- Chat Messages -->
        <div class="chat-messages" id="chat-messages">
            <div class="welcome">
                <h2>Construction SOW Generator</h2>
                <p>I turn your construction information into polished, contract-ready Scopes of Work.</p>
                
                <h3 style="font-size: 1.1rem; margin: 2rem 0 1rem; color: #ff6b35;">How would you like to get started?</h3>
                
                <div class="example-prompts">
                    <div class="example-prompt" onclick="startManual()">
                        ‚úçÔ∏è <strong>Build Manually</strong> - Answer guided questions about your project
                    </div>
                    <div class="example-prompt" onclick="showUpload()">
                        üìê <strong>Upload Documents</strong> - I'll analyze blueprints, specs, and drawings
                    </div>
                </div>

                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #565869;">
                    <h4 style="font-size: 0.9rem; color: #c5c5d2; margin-bottom: 1rem;">Or learn more:</h4>
                    <div class="example-prompts">
                        <div class="example-prompt" onclick="useExample('What documents do I need for best results?')">
                            üìã What documents do I need for best results?
                        </div>
                        <div class="example-prompt" onclick="useExample('Show me an example SOW output')">
                            üìÑ Show me an example SOW output
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <div class="input-container">
                <button class="upload-btn" onclick="showUpload()" title="Upload construction documents">
                    <span>üìé</span>
                </button>
                <textarea 
                    class="chat-input" 
                    id="chat-input" 
                    placeholder="Ask about SOW generation, document requirements, or upload your construction documents..."
                    rows="1"></textarea>
                <button class="send-button" onclick="sendMessage()">
                    <span class="send-icon">‚Üë</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div class="upload-modal" id="upload-modal">
        <div class="upload-content">
            <h3>Upload Construction Documents</h3>
            <p style="color: #8e8ea0; margin-bottom: 1rem;">For best results, upload as many relevant documents as possible</p>
            
            <div style="background: rgba(255, 107, 53, 0.1); border: 1px solid rgba(255, 107, 53, 0.3); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                <p style="color: #ff6b35; font-weight: 600; margin-bottom: 0.5rem;">‚ö†Ô∏è Demo Prototype Notice</p>
                <p style="color: #c5c5d2; font-size: 0.85rem; line-height: 1.5;">This is a prototype demonstration. Document uploads will show example SOW output only. The live GPT version will analyze your actual construction documents and generate custom scopes of work.</p>
            </div>
            
            <div class="upload-area" onclick="triggerFileInput()">
                <div class="upload-icon">üìÅ</div>
                <p style="color: #ececf1; margin-bottom: 0.5rem;">Click to upload or drag and drop</p>
                <p style="color: #8e8ea0; font-size: 0.85rem;">PDF, DWG, DXF, PNG, JPG (Max 25MB per file)</p>
            </div>

            <div class="upload-tips">
                <h4>Recommended Documents to Upload:</h4>
                <ul>
                    <li>Architectural blueprints and floor plans</li>
                    <li>Site plans and survey documents</li>
                    <li>Specification sheets and material lists</li>
                    <li>Engineering drawings and structural plans</li>
                    <li>Electrical and plumbing schematics</li>
                    <li>Building code requirements</li>
                    <li>Client sketches or reference images</li>
                    <li>Previous inspection reports</li>
                </ul>
            </div>

            <input type="file" id="file-input" accept=".pdf,.dwg,.dxf,.png,.jpg,.jpeg,.doc,.docx" multiple style="display: none;" onchange="handleFileSelect()">
            
            <div class="upload-buttons">
                <button class="modal-btn modal-btn-secondary" onclick="closeUpload()">Cancel</button>
                <button class="modal-btn modal-btn-primary" onclick="confirmUpload()">Generate SOW</button>
            </div>
        </div>
    </div>

    <script>
        let isTyping = false;
        let selectedFiles = [];
        let hasDocuments = false;
        let manualMode = false;
        let projectData = {};
        let currentQuestion = 0;

        // Auto-resize textarea
        const textarea = document.getElementById('chat-input');
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 200) + 'px';
        });

        // Start Manual Mode
        function startManual() {
            const welcome = document.querySelector('.welcome');
            if (welcome) welcome.remove();
            
            manualMode = true;
            currentQuestion = 0;
            projectData = {};
            
            addAIMessage(`
                <h4>‚úçÔ∏è Let's Build Your SOW Together</h4>
                <p>I'll ask you a series of questions to gather all the details I need for your contract-ready Scope of Work.</p>
                <p style="margin-top: 1rem;"><strong>First question:</strong></p>
                <p>What type of project are you working on?</p>
                <ul style="margin-top: 0.5rem;">
                    <li>1Ô∏è‚É£ Residential Renovation (kitchen, bathroom, addition, etc.)</li>
                    <li>2Ô∏è‚É£ New Home Construction</li>
                    <li>3Ô∏è‚É£ Commercial Building</li>
                    <li>4Ô∏è‚É£ Pool & Outdoor Structures</li>
                    <li>5Ô∏è‚É£ Multi-Purpose / Mixed-Use</li>
                    <li>6Ô∏è‚É£ Other</li>
                </ul>
                <p style="margin-top: 1rem; color: #c5c5d2;">Just type the number or name of your project type.</p>
            `);
        }
        function showUpload() {
            document.getElementById('upload-modal').classList.add('active');
        }

        function closeUpload() {
            document.getElementById('upload-modal').classList.remove('active');
        }

        function triggerFileInput() {
            document.getElementById('file-input').click();
        }

        function handleFileSelect(event) {
            const fileInput = document.getElementById('file-input');
            selectedFiles = Array.from(fileInput.files);
        }

        function confirmUpload() {
            closeUpload();
            hasDocuments = true;
            
            if (selectedFiles.length > 0) {
                const fileNames = selectedFiles.map(f => f.name).join(', ');
                addUserMessage(`I've uploaded ${selectedFiles.length} document(s): ${fileNames}`);
            } else {
                addUserMessage('Generate a detailed SOW from my construction documents');
            }
            
            // Show analysis first
            setTimeout(() => {
                simulateAIResponse('documents uploaded');
                
                // Then automatically show the full SOW after a delay
                setTimeout(() => {
                    simulateAIResponse('generate sow');
                }, 2000);
            }, 500);
            
            selectedFiles = [];
            document.getElementById('file-input').value = '';
        }

        // Send Message
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (message === '' || isTyping) return;
            
            const welcome = document.querySelector('.welcome');
            if (welcome) welcome.remove();
            
            addUserMessage(message);
            input.value = '';
            input.style.height = 'auto';
            
            simulateAIResponse(message);
        }

        function addUserMessage(text) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-wrapper user';
            messageDiv.innerHTML = `
                <div class="message">
                    <div class="avatar user">You</div>
                    <div class="message-content">${escapeHtml(text)}</div>
                </div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function addAIMessage(html) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-wrapper assistant';
            messageDiv.innerHTML = `
                <div class="message">
                    <div class="avatar assistant">AI</div>
                    <div class="message-content">${html}</div>
                </div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function showTyping() {
            const messagesContainer = document.getElementById('chat-messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message-wrapper assistant';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="message">
                    <div class="avatar assistant">AI</div>
                    <div class="message-content">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTyping() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
        }

        function simulateAIResponse(userMessage) {
            isTyping = true;
            showTyping();
            
            setTimeout(() => {
                hideTyping();
                const response = getAIResponse(userMessage);
                addAIMessage(response);
                isTyping = false;
            }, 1500);
        }

        function getAIResponse(message) {
            const lower = message.toLowerCase();
            
            // Handle manual mode questions
            if (manualMode) {
                return handleManualQuestions(message);
            }
            
            // Documents uploaded - start analysis
            if (lower.includes('uploaded') || lower.includes('documents uploaded')) {
                return `
                    <div style="background: rgba(255, 107, 53, 0.1); border-left: 3px solid #ff6b35; padding: 1rem; margin-bottom: 1rem; border-radius: 4px;">
                        <p style="color: #ff6b35; font-weight: 600; margin-bottom: 0.5rem;">üìã Demo Prototype - Example Analysis</p>
                        <p style="color: #c5c5d2; font-size: 0.85rem;">The analysis and SOW below are demonstration examples. The live GPT version will analyze your actual uploaded documents.</p>
                    </div>
                    <h4>üìê Document Analysis Complete</h4>
                    <p><strong>Documents Processed:</strong></p>
                    <ul>
                        <li>‚úÖ Architectural blueprints (3 sheets) - A-1.1, A-2.1, A-3.1</li>
                        <li>‚úÖ Electrical schematics (2 sheets) - E-1.1, E-2.1</li>
                        <li>‚úÖ Plumbing plans (1 sheet) - P-1.1</li>
                        <li>‚úÖ Specification document (24 pages)</li>
                        <li>‚úÖ Site survey data</li>
                    </ul>
                    
                    <p><strong>What I Found:</strong></p>
                    <ul>
                        <li><strong>Project Type:</strong> Residential kitchen renovation</li>
                        <li><strong>Total Area:</strong> 285 square feet</li>
                        <li><strong>Key Materials Specified:</strong> Maple cabinetry, quartz countertops, LVP flooring</li>
                        <li><strong>Electrical Requirements:</strong> 6 new dedicated circuits, panel modifications required</li>
                        <li><strong>Structural Work:</strong> Load-bearing header installation for window opening</li>
                        <li><strong>Code References:</strong> NEC 2023, local residential building code</li>
                    </ul>
                    
                    <p><strong>‚ö†Ô∏è Flagged Issues:</strong></p>
                    <ul>
                        <li>HVAC ductwork relocation not shown on mechanicals - need coordination</li>
                        <li>Appliance rough-in dimensions missing - awaiting client selections</li>
                        <li>Permit requirements not specified - verify with local jurisdiction</li>
                    </ul>
                    
                    <p style="margin-top: 1rem; padding: 1rem; background: #40414f; border-radius: 8px;">
                        ‚ú® <strong>Generating your complete contract-ready SOW package...</strong>
                    </p>
                `;
            }
            
            // Generate SOW
            if ((lower.includes('generate') || lower.includes('create') || lower.includes('sow') || lower.includes('proceed')) && hasDocuments) {
                return `
                    <h4>üìÑ Complete Contract-Ready Package</h4>
                    
                    <p><strong>PROJECT: Residential Kitchen Renovation - 1247 Oak Street</strong></p>
                    
                    <hr style="border: 1px solid #565869; margin: 1rem 0;">
                    
                    <p><strong>1Ô∏è‚É£ DOCUMENT ANALYSIS SUMMARY</strong></p>
                    <ul>
                        <li><strong>Project Scope:</strong> Complete kitchen renovation including demolition, structural modifications, all trades coordination, and finish work</li>
                        <li><strong>Area:</strong> 285 SF main kitchen + 45 SF pantry modification</li>
                        <li><strong>Existing Conditions:</strong> 1970s construction, original electrical panel requires upgrade, subfloor leveling needed</li>
                        <li><strong>Design Intent:</strong> Modern open-concept with island, improved workflow, upgraded appliances</li>
                    </ul>
                    
                    <hr style="border: 1px solid #565869; margin: 1rem 0;">
                    
                    <p><strong>2Ô∏è‚É£ SCOPE OF WORK (Contract-Ready)</strong></p>
                    
                    <p><strong>2.1 Demolition & Site Protection</strong></p>
                    <ul>
                        <li>Remove all existing cabinetry, countertops, and fixtures (customer retains appliances)</li>
                        <li>Demo ceramic tile backsplash (estimated 65 SF) and vinyl sheet flooring (285 SF)</li>
                        <li>Protect adjacent living areas with sealed dust barriers per OSHA standards</li>
                        <li>Provide on-site dumpster (10-yard) for debris removal, estimated 4 tons</li>
                    </ul>
                    
                    <p><strong>2.2 Structural & Framing</strong></p>
                    <ul>
                        <li>Install engineered header beam (3.5" x 14" LVL) over new 60" window opening per structural engineer drawings (Dwg S-1.1)</li>
                        <li>Frame soffit enclosure (2x4 construction) for HVAC duct relocation - coordinate with mechanical contractor</li>
                        <li>Sister existing floor joists as needed for subfloor leveling (estimated 3 joists)</li>
                        <li>Install moisture barrier under all new flooring per manufacturer specification</li>
                    </ul>
                    
                    <p><strong>2.3 Electrical (per NEC 2023)</strong></p>
                    <ul>
                        <li>Install six (6) new dedicated 20A circuits: refrigerator, microwave, dishwasher, disposal, and two counter receptacles</li>
                        <li>Upgrade main panel to 200A service (coordinate with utility company for disconnect)</li>
                        <li>Provide GFCI-protected outlets minimum 2 above countertop per code requirement</li>
                        <li>Install under-cabinet LED lighting system (18W per linear foot, dimmable, hardwired)</li>
                        <li>Relocate existing switch locations per plan A-3.1</li>
                    </ul>
                    
                    <p><strong>2.4 Plumbing</strong></p>
                    <ul>
                        <li>Relocate sink drain and water supply lines for island location (Dwg P-1.1)</li>
                        <li>Install dishwasher supply line, drain connection, and dedicated shutoff</li>
                        <li>Provide ice maker line with compression shutoff valve</li>
                        <li>Install garbage disposal with air gap and proper venting</li>
                    </ul>
                    
                    <p><strong>2.5 Cabinetry & Countertops</strong></p>
                    <ul>
                        <li>Furnish and install custom maple cabinetry, shaker style, soft-close hardware throughout (per shop drawings and spec sheet)</li>
                        <li>Install quartz countertops, 3cm thickness, eased edge profile - total 85 linear feet including island</li>
                        <li>Provide undermount sink cutout and polished edges per fabricator standards</li>
                        <li>Install tile backsplash (3x6 subway tile, customer selection) - approximately 65 SF</li>
                    </ul>
                    
                    <p><strong>2.6 Flooring & Finishes</strong></p>
                    <ul>
                        <li>Install luxury vinyl plank flooring (6mm commercial grade, AC4 rated) - 285 SF</li>
                        <li>Provide matching transition strips and baseboards (3.25" colonial profile)</li>
                        <li>Paint all walls and ceiling (2 coats Sherwin Williams ProMar 200, customer color selection)</li>
                        <li>Install new window trim and casing to match existing home</li>
                    </ul>
                    
                    <hr style="border: 1px solid #565869; margin: 1rem 0;">
                    
                    <p><strong>3Ô∏è‚É£ PROJECT PHASES & TIMELINE</strong></p>
                    <ul>
                        <li><strong>Phase 1 - Demolition (Days 1-3):</strong> Complete demo, dumpster removal, site cleaning</li>
                        <li><strong>Phase 2 - Structural/Rough-In (Days 4-10):</strong> Framing, electrical rough-in, plumbing rough-in, HVAC coordination</li>
                        <li><strong>Phase 3 - Inspections (Days 11-12):</strong> Electrical, plumbing, framing inspections with city</li>
                        <li><strong>Phase 4 - Insulation/Drywall (Days 13-18):</strong> Insulate, hang and finish drywall, texture, prime</li>
                        <li><strong>Phase 5 - Cabinetry (Days 19-25):</strong> Cabinet installation, countertop template, countertop install</li>
                        <li><strong>Phase 6 - Finishes (Days 26-35):</strong> Flooring, backsplash, painting, trim, final electrical/plumbing connections</li>
                        <li><strong>Phase 7 - Final Inspection & Turnover (Days 36-37):</strong> Punch list, final inspection, client walkthrough</li>
                    </ul>
                    <p><strong>Total Duration:</strong> 37 working days (approximately 7-8 weeks from permit approval)</p>
                    
                    <hr style="border: 1px solid #565869; margin: 1rem 0;">
                    
                    <p><strong>4Ô∏è‚É£ MATERIALS LIST</strong></p>
                    <ul>
                        <li><strong>Cabinetry:</strong> Custom maple, shaker door style, soft-close hinges and drawer glides (Blum brand), 18 base cabinets, 12 wall cabinets, 1 island base</li>
                        <li><strong>Countertops:</strong> Engineered quartz, 3cm, color TBD by customer, eased edge profile, 85 LF total</li>
                        <li><strong>Flooring:</strong> Luxury vinyl plank, 6mm thickness, AC4 wear rating, attached underlayment, 285 SF + 10% waste factor</li>
                        <li><strong>Backsplash:</strong> Ceramic tile 3"x6" subway style, white grout, 65 SF + 10% waste</li>
                        <li><strong>Electrical:</strong> 200A panel upgrade, (6) 20A GFCI breakers, 14/2 and 12/2 Romex, LED under-cabinet lights (60 LF)</li>
                        <li><strong>Plumbing:</strong> PEX supply lines, ABS drain fittings, undermount sink (customer-provided), faucet (customer-provided)</li>
                        <li><strong>Paint:</strong> Sherwin Williams ProMar 200 interior latex, 2 coats walls/ceiling, color TBD</li>
                        <li><strong>Structural:</strong> 3.5"x14" LVL beam (10' length), (12) 2x4x8 studs for soffit, engineered floor joist material as needed</li>
                    </ul>
                    
                    <hr style="border: 1px solid #565869; margin: 1rem 0;">
                    
                    <p><strong>5Ô∏è‚É£ FLAGGED ISSUES & CLARIFICATIONS NEEDED</strong></p>
                    <ul>
                        <li>‚ö†Ô∏è <strong>HVAC Coordination:</strong> Ductwork relocation shown on architectural but not included in mechanical drawings - requires separate mechanical contractor coordination and pricing</li>
                        <li>‚ö†Ô∏è <strong>Appliance Specifications:</strong> Rough-in dimensions for refrigerator, range, and microwave not provided - need make/model to finalize electrical and dimensional requirements</li>
                        <li>‚ö†Ô∏è <strong>Permit Requirements:</strong> Local jurisdiction permit fees and timeline not specified - recommend 2-3 week lead time for permit approval</li>
                        <li>‚ö†Ô∏è <strong>Structural Engineering:</strong> Stamped structural drawings required for header beam installation - confirm engineer availability and schedule</li>
                        <li>‚ö†Ô∏è <strong>Lead Paint Testing:</strong> 1970s construction may contain lead paint - recommend testing before demo (additional $350-500)</li>
                    </ul>
                    
                    <hr style="border: 1px solid #565869; margin: 1rem 0;">
                    
                    <p><strong>6Ô∏è‚É£ CONTRACT TEMPLATE</strong></p>
                    <p><strong>SCOPE OF WORK AGREEMENT</strong></p>
                    <p>This Agreement is entered into on [DATE] between [CONTRACTOR NAME] ("Contractor") and [CLIENT NAME] ("Client") for the work described herein.</p>
                    
                    <p><strong>Project Address:</strong> 1247 Oak Street, [City, State ZIP]</p>
                    <p><strong>Work Description:</strong> Complete kitchen renovation as described in sections 2.1-2.6 above and per attached drawings A-1.1, A-2.1, A-3.1, E-1.1, E-2.1, P-1.1.</p>
                    
                    <p><strong>Contract Price:</strong> $67,500.00 (materials and labor)</p>
                    <p><strong>Payment Schedule:</strong></p>
                    <ul>
                        <li>Deposit: $13,500 (20%) - Due upon contract signing</li>
                        <li>Progress Payment 1: $20,250 (30%) - Due upon completion of rough-ins and inspections</li>
                        <li>Progress Payment 2: $20,250 (30%) - Due upon cabinet and countertop installation</li>
                        <li>Final Payment: $13,500 (20%) - Due upon final inspection and client acceptance</li>
                    </ul>
                    
                    <p><strong>Timeline:</strong> Work to commence within 5 business days of permit approval. Estimated completion 37 working days from start date.</p>
                    
                    <p><strong>Exclusions:</strong></p>
                    <ul>
                        <li>Appliances (customer-provided)</li>
                        <li>HVAC ductwork modifications (separate contractor)</li>
                        <li>Structural engineering fees</li>
                        <li>Permit fees</li>
                        <li>Lead paint testing and abatement (if required)</li>
                    </ul>
                    
                    <p><strong>Warranty:</strong> Contractor warrants all workmanship for one (1) year from date of substantial completion. Material warranties per manufacturer specifications.</p>
                    
                    <hr style="border: 1px solid #565869; margin: 1rem 0;">
                    
                    <p style="margin-top: 1rem; color: #c5c5d2;">‚úÖ <strong>Your complete contract package is ready!</strong> This can be exported as PDF or Word document. Would you like me to refine any section or address the flagged issues?</p>
                `;
            }
            
            // What documents needed
            if (lower.includes('what documents') || lower.includes('what do i need') || lower.includes('requirements')) {
                return `
                    <h4>üìã Document Requirements for Best Results</h4>
                    <p><strong>Essential Documents (Upload these first):</strong></p>
                    <ul>
                        <li><strong>Architectural Blueprints:</strong> Floor plans, elevations, sections</li>
                        <li><strong>Specification Sheets:</strong> Material specs, finish schedules</li>
                        <li><strong>Engineering Drawings:</strong> Structural, MEP (mechanical, electrical, plumbing)</li>
                    </ul>
                    
                    <p><strong>Highly Recommended:</strong></p>
                    <ul>
                        <li><strong>Site Plans:</strong> Survey data, lot boundaries, utilities</li>
                        <li><strong>Code Requirements:</strong> Local building codes, HOA restrictions</li>
                        <li><strong>Material Lists:</strong> Existing takeoffs or estimates</li>
                    </ul>
                    
                    <p><strong>Optional but Helpful:</strong></p>
                    <ul>
                        <li>Client sketches or design inspiration</li>
                        <li>Photos of existing conditions</li>
                        <li>Previous inspection reports</li>
                        <li>Manufacturer cut sheets for specified products</li>
                    </ul>
                    
                    <p><strong>Supported File Types:</strong></p>
                    <ul>
                        <li>PDF, DWG, DXF (CAD drawings)</li>
                        <li>PNG, JPG (images and scans)</li>
                        <li>DOC, DOCX (specifications)</li>
                    </ul>
                    
                    <p style="margin-top: 1rem;">üí° <strong>Pro Tip:</strong> The more documents you provide, the more accurate and detailed your SOW will be. Upload multiple files at once using the üìé button.</p>
                `;
            }
            
            // Example SOW
            if (lower.includes('example') || lower.includes('show me')) {
                return `
                    <h4>üìÑ Example SOW Output</h4>
                    <p>Here's what a generated SOW looks like:</p>
                    
                    <p><strong>Format:</strong> Professional, contract-ready document</p>
                    <p><strong>Sections Included:</strong></p>
                    <ul>
                        <li>Project overview and location details</li>
                        <li>Detailed scope broken down by trade</li>
                        <li>Material specifications with quantities</li>
                        <li>Labor requirements and coordination notes</li>
                        <li>Timeline with milestones and dependencies</li>
                        <li>Code compliance requirements</li>
                        <li>Exclusions and assumptions</li>
                        <li>Payment schedule recommendations</li>
                        <li>Cost estimates (materials + labor)</li>
                    </ul>
                    
                    <p><strong>Key Features:</strong></p>
                    <ul>
                        <li>‚úÖ Uses your company's voice and terminology</li>
                        <li>‚úÖ References specific drawing numbers and specs</li>
                        <li>‚úÖ Includes quantities extracted from plans</li>
                        <li>‚úÖ Organizes work by trade and sequence</li>
                        <li>‚úÖ Flags potential issues or clarifications needed</li>
                    </ul>
                    
                    <p style="margin-top: 1rem;">Ready to create your own? Upload your construction documents to get started!</p>
                `;
            }
            
            // How it works
            if (lower.includes('how') && (lower.includes('work') || lower.includes('analysis') || lower.includes('process'))) {
                return `
                    <h4>üîç Multi-Document Intelligence Engine</h4>
                    <p><strong>Here's how I analyze your construction documents:</strong></p>
                    
                    <p><strong>Step 1: Document Processing</strong></p>
                    <ul>
                        <li>Read and parse blueprints, specs, and drawings</li>
                        <li>Extract text, dimensions, symbols, and annotations</li>
                        <li>Identify document types and relationships</li>
                    </ul>
                    
                    <p><strong>Step 2: Intelligent Analysis</strong></p>
                    <ul>
                        <li>Cross-reference information across all documents</li>
                        <li>Calculate square footage, materials, and quantities</li>
                        <li>Identify code requirements and specifications</li>
                        <li>Detect conflicts or missing information</li>
                    </ul>
                    
                    <p><strong>Step 3: SOW Generation</strong></p>
                    <ul>
                        <li>Organize work by trade and logical sequence</li>
                        <li>Write detailed scope in your company's style</li>
                        <li>Include all extracted specifications and quantities</li>
                        <li>Reference specific drawing numbers and details</li>
                    </ul>
                    
                    <p><strong>Step 4: Quality Assurance</strong></p>
                    <ul>
                        <li>Ensure nothing is overlooked</li>
                        <li>Verify completeness and accuracy</li>
                        <li>Format for contract-ready presentation</li>
                    </ul>
                    
                    <p style="margin-top: 1rem;"><strong>Result:</strong> A polished, detailed SOW that's consistent, accurate, and saves you hours of manual work.</p>
                `;
            }
            
            // Need documents first
            if (!hasDocuments && (lower.includes('generate') || lower.includes('create') || lower.includes('sow'))) {
                return `
                    <h4>I need construction documents first</h4>
                    <p>To generate a detailed, contract-ready SOW, please upload your construction documents.</p>
                    
                    <p><strong>Recommended documents:</strong></p>
                    <ul>
                        <li>Architectural blueprints and floor plans</li>
                        <li>Specification sheets and material lists</li>
                        <li>Engineering drawings (structural, MEP)</li>
                        <li>Site plans and survey documents</li>
                    </ul>
                    
                    <p style="margin-top: 1rem;">Click the üìé paperclip icon to upload multiple documents at once.</p>
                `;
            }
            
            // Default response
            return `
                <p>I'm your Construction SOW Generator. I turn raw construction documents into polished, contract-ready Scopes of Work.</p>
                
                <p><strong>What I can help you with:</strong></p>
                <ul>
                    <li><strong>Generate Detailed SOWs:</strong> Upload blueprints and specs to create comprehensive scopes</li>
                    <li><strong>Multi-Document Analysis:</strong> I read drawings, specs, submittals, and images</li>
                    <li><strong>Extract Key Details:</strong> Square footage, materials, quantities, code requirements</li>
                    <li><strong>Organize by Trade:</strong> Logical sequencing and coordination notes</li>
                    <li><strong>Cost Estimates:</strong> Material and labor calculations</li>
                    <li><strong>Timeline Creation:</strong> Milestones and dependencies</li>
                </ul>
                
                <p style="margin-top: 1rem;">To get started, upload your construction documents using the üìé button, or ask me about the process!</p>
            `;
        }

        // Use Example
        function useExample(text) {
            document.getElementById('chat-input').value = text;
            document.getElementById('chat-input').focus();
        }

        // Clear Chat
        function clearChat() {
            hasDocuments = false;
            manualMode = false;
            projectData = {};
            currentQuestion = 0;
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.innerHTML = `
                <div class="welcome">
                    <h2>Construction SOW Generator</h2>
                    <p>I turn your construction information into polished, contract-ready Scopes of Work.</p>
                    
                    <h3 style="font-size: 1.1rem; margin: 2rem 0 1rem; color: #ff6b35;">How would you like to get started?</h3>
                    
                    <div class="example-prompts">
                        <div class="example-prompt" onclick="startManual()">
                            ‚úçÔ∏è <strong>Build Manually</strong> - Answer guided questions about your project
                        </div>
                        <div class="example-prompt" onclick="showUpload()">
                            üìê <strong>Upload Documents</strong> - I'll analyze blueprints, specs, and drawings
                        </div>
                    </div>

                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #565869;">
                        <h4 style="font-size: 0.9rem; color: #c5c5d2; margin-bottom: 1rem;">Or learn more:</h4>
                        <div class="example-prompts">
                            <div class="example-prompt" onclick="useExample('What documents do I need for best results?')">
                                üìã What documents do I need for best results?
                            </div>
                            <div class="example-prompt" onclick="useExample('Show me an example SOW output')">
                                üìÑ Show me an example SOW output
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Handle Manual Questions Flow
        function handleManualQuestions(message) {
            const lower = message.toLowerCase();
            
            // Question 0: Project Type
            if (currentQuestion === 0) {
                if (lower.includes('1') || lower.includes('residential') || lower.includes('renovation')) {
                    projectData.type = 'Residential Renovation';
                    currentQuestion = 1;
                    return `
                        <p>Great! <strong>Residential Renovation</strong> it is.</p>
                        <p style="margin-top: 1rem;"><strong>Question 2:</strong> What specific area(s) are you renovating?</p>
                        <p style="color: #c5c5d2; font-size: 0.9rem;">(e.g., Kitchen, Bathroom, Basement, Addition, Multiple rooms)</p>
                    `;
                } else if (lower.includes('2') || lower.includes('new home') || lower.includes('new construction')) {
                    projectData.type = 'New Home Construction';
                    currentQuestion = 1;
                    return `
                        <p>Excellent! <strong>New Home Construction</strong>.</p>
                        <p style="margin-top: 1rem;"><strong>Question 2:</strong> What is the total square footage of the home?</p>
                    `;
                } else if (lower.includes('3') || lower.includes('commercial')) {
                    projectData.type = 'Commercial Building';
                    currentQuestion = 1;
                    return `
                        <p>Perfect! <strong>Commercial Building</strong> project.</p>
                        <p style="margin-top: 1rem;"><strong>Question 2:</strong> What type of commercial space? (office, retail, restaurant, warehouse, etc.)</p>
                    `;
                } else if (lower.includes('4') || lower.includes('pool') || lower.includes('outdoor')) {
                    projectData.type = 'Pool & Outdoor Structures';
                    currentQuestion = 1;
                    return `
                        <p>Nice! <strong>Pool & Outdoor Structures</strong>.</p>
                        <p style="margin-top: 1rem;"><strong>Question 2:</strong> What are you building? (inground pool, above ground pool, deck, pergola, outdoor kitchen, etc.)</p>
                    `;
                } else {
                    projectData.type = message;
                    currentQuestion = 1;
                    return `
                        <p>Got it! Project type: <strong>${message}</strong></p>
                        <p style="margin-top: 1rem;"><strong>Question 2:</strong> Please describe what work needs to be done.</p>
                    `;
                }
            }
            
            // Question 1: Specific Areas (Residential Renovation)
            if (currentQuestion === 1) {
                projectData.areas = message;
                currentQuestion = 2;
                return `
                    <p>Perfect! Working on: <strong>${message}</strong></p>
                    <p style="margin-top: 1rem;"><strong>Question 3:</strong> What is the project address?</p>
                    <p style="color: #c5c5d2; font-size: 0.9rem;">(Street address, City, State)</p>
                `;
            }
            
            // Question 2: Address
            if (currentQuestion === 2) {
                projectData.address = message;
                currentQuestion = 3;
                return `
                    <p>Thank you! Address: <strong>${message}</strong></p>
                    <p style="margin-top: 1rem;"><strong>Question 4:</strong> What is the approximate square footage of the work area?</p>
                    <p style="color: #c5c5d2; font-size: 0.9rem;">(If you're not sure, give your best estimate)</p>
                `;
            }
            
            // Question 3: Square Footage
            if (currentQuestion === 3) {
                projectData.squareFootage = message;
                currentQuestion = 4;
                return `
                    <p>Great! Approximately <strong>${message} square feet</strong>.</p>
                    <p style="margin-top: 1rem;"><strong>Question 5:</strong> What major work items are included?</p>
                    <p>Tell me what needs to be done. For example:</p>
                    <ul style="margin-top: 0.5rem; color: #c5c5d2; font-size: 0.9rem;">
                        <li>Demolition</li>
                        <li>Framing/structural work</li>
                        <li>Electrical upgrades</li>
                        <li>Plumbing modifications</li>
                        <li>Flooring installation</li>
                        <li>Cabinetry and countertops</li>
                        <li>Painting and finishes</li>
                    </ul>
                `;
            }
            
            // Question 4: Work Items
            if (currentQuestion === 4) {
                projectData.workItems = message;
                currentQuestion = 5;
                return `
                    <p>Excellent detail! I've noted all the work items.</p>
                    <p style="margin-top: 1rem;"><strong>Question 6:</strong> Are there any specific materials or finishes the client has selected?</p>
                    <p style="color: #c5c5d2; font-size: 0.9rem;">(Brands, styles, colors - or type "None yet" if selections haven't been made)</p>
                `;
            }
            
            // Question 5: Materials
            if (currentQuestion === 5) {
                projectData.materials = message;
                currentQuestion = 6;
                return `
                    <p>Perfect! Material selections noted.</p>
                    <p style="margin-top: 1rem;"><strong>Question 7:</strong> What is the expected timeline for this project?</p>
                    <p style="color: #c5c5d2; font-size: 0.9rem;">(e.g., "6-8 weeks", "Must be done by June 1st", or "Flexible")</p>
                `;
            }
            
            // Question 6: Timeline
            if (currentQuestion === 6) {
                projectData.timeline = message;
                currentQuestion = 7;
                return `
                    <p>Got it! Timeline: <strong>${message}</strong></p>
                    <p style="margin-top: 1rem;"><strong>Question 8:</strong> What is the estimated budget range for this project?</p>
                    <p style="color: #c5c5d2; font-size: 0.9rem;">(e.g., "$50K-75K", "Under $100K", or "Budget to be determined")</p>
                `;
            }
            
            // Question 7: Budget
            if (currentQuestion === 7) {
                projectData.budget = message;
                currentQuestion = 8;
                return `
                    <p>Excellent! Budget range: <strong>${message}</strong></p>
                    <p style="margin-top: 1rem;"><strong>Final Question:</strong> Are there any special requirements, concerns, or important notes I should include?</p>
                    <p style="color: #c5c5d2; font-size: 0.9rem;">(Building code issues, HOA restrictions, existing problems, client special requests - or type "None")</p>
                `;
            }
            
            // Question 8: Special Requirements - Generate SOW
            if (currentQuestion === 8) {
                projectData.specialRequirements = message;
                hasDocuments = true; // Allow SOW generation
                manualMode = false; // Exit manual mode
                return `
                    <h4>‚úÖ Information Gathering Complete!</h4>
                    <p>Perfect! I have everything I need:</p>
                    <ul>
                        <li><strong>Project Type:</strong> ${projectData.type}</li>
                        <li><strong>Areas:</strong> ${projectData.areas}</li>
                        <li><strong>Address:</strong> ${projectData.address}</li>
                        <li><strong>Square Footage:</strong> ${projectData.squareFootage}</li>
                        <li><strong>Timeline:</strong> ${projectData.timeline}</li>
                        <li><strong>Budget:</strong> ${projectData.budget}</li>
                    </ul>
                    <p style="margin-top: 1rem;">Ready to generate your complete, contract-ready SOW package!</p>
                    <p><strong>Type "generate SOW" to create your document, or ask me to clarify/change any information.</strong></p>
                `;
            }
            
            // Default for manual mode
            return `
                <p>I didn't quite catch that. Could you please answer the question above?</p>
            `;
        }

        // Scroll to bottom
        function scrollToBottom() {
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Enter to send, Shift+Enter for new line
        document.getElementById('chat-input').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
    </script>
</body>
</html>